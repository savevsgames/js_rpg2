var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{P as s}from"./phaser-CmFXOKba.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class i{constructor(e){t(this,"gameObject"),t(this,"target","GAME_OBJECT"),t(this,"targetName",""),this.gameObject=e,e.__ActionTargetComp=this}static getComponent(e){return e.__ActionTargetComp}static getTargetGameObject(e,t){const s=i.getComponent(e);if(s)switch(s.target){case"GAME_OBJECT":return e.gameObject;case"ARG_1":return t[0];case"ARG_2":return t[1];case"ARG_3":return t[2];case"ARG_4":return t[3];case"ARG_5":return t[4];case"ARG_6":return t[5];case"ARG_7":return t[6];case"ARG_8":return t[7]}return e.gameObject}}class n{constructor(e){t(this,"_scene"),t(this,"_gameObject"),t(this,"_parent"),t(this,"_children"),this._parent=e,e instanceof n?(this._scene=e.scene,this._gameObject=e.gameObject,e.add(this)):e instanceof s.GameObjects.GameObject?(this._scene=e.scene,this._gameObject=e):this._scene=e;const i=this.awake!==n.prototype.awake,r=this.start!==n.prototype.start,a=this.update!==n.prototype.update,c=this.destroy!==n.prototype.destroy;if(i&&this.scene.events.once("scene-awake",this.awake,this),r&&this.scene.events.once(s.Scenes.Events.UPDATE,this.start,this),a&&this.scene.events.on(s.Scenes.Events.UPDATE,this.update,this),i||r||a||c){const e=()=>{this.scene.events.off("scene-awake",this.awake,this),this.scene.events.off(s.Scenes.Events.UPDATE,this.start,this),this.scene.events.off(s.Scenes.Events.UPDATE,this.update,this),c&&this.destroy()};this.gameObject?this.gameObject.on(s.GameObjects.Events.DESTROY,e):this.scene.events.on(s.Scenes.Events.SHUTDOWN,e)}}getActionTargetObject(e){return i.getTargetGameObject(this,e)}get scene(){return this._scene}get gameObject(){return this._gameObject}get parent(){return this._parent}get children(){return this._children||(this._children=[]),this._children}add(e){this.children.push(e)}executeChildren(...e){if(this._children)for(const t of this._children)t.execute(...e)}execute(...e){}awake(){}start(){}update(){}destroy(){}}class r extends n{constructor(e){super(e),this.scene.events.once("scene-awake",(()=>{this.executeChildren()}))}}class a extends n{constructor(e){super(e),t(this,"eventName",""),t(this,"eventEmitter","gameObject"),t(this,"once",!1)}awake(){let e;switch(this.eventEmitter){case"game.events":e=this.scene.game.events;break;case"scene.events":e=this.scene.events;break;case"scene.loader":e=this.scene.load;break;case"scene.input":e=this.scene.input;break;case"scene.input.keyboard":e=this.scene.input.keyboard;break;case"scene.anims":e=this.scene.anims;break;case"scene.physics.world":e=this.scene.physics.world;break;case"gameObject":e=this.gameObject}if(e){switch(this.once?e.once(this.eventName,this.executeChildren,this):e.on(this.eventName,this.executeChildren,this),this.eventEmitter){case"scene.anims":case"scene.events":case"scene.input":case"scene.input.keyboard":case"scene.loader":case"scene.physics.world":this.scene.events.on(s.Scenes.Events.SHUTDOWN,(()=>{null==e||e.off(this.eventName,this.executeChildren,this)}))}this.gameObject&&"gameObject"!==this.eventEmitter&&this.gameObject.once(s.GameObjects.Events.DESTROY,(()=>{null==e||e.off(this.eventName,this.executeChildren,this)}))}}}class c extends a{constructor(e){super(e),this.eventName="pointerdown"}awake(){this.gameObject&&(this.gameObject.input||this.gameObject.setInteractive(),super.awake())}}class o{constructor(e){t(this,"gameObject"),t(this,"delay",0),this.gameObject=e,e.__DelayConfigComp=this}static getComponent(e){return e.__DelayConfigComp}static getDelay(e,t){const s=o.getComponent(e);return s?s.delay:t}}class h{constructor(e){t(this,"gameObject"),t(this,"duration",250),this.gameObject=e,e.__DurationConfigComp=this}static getComponent(e){return e.__DurationConfigComp}static getDuration(e,t){const s=h.getComponent(e);return s?s.duration:t}}class l{constructor(e){t(this,"gameObject"),t(this,"ease","Linear"),this.gameObject=e,e.__EaseConfigComp=this}static getComponent(e){return e.__EaseConfigComp}static getEase(e,t){const s=l.getComponent(e);return s?s.ease:t}}class d extends n{constructor(e){super(e),t(this,"from","NONE")}execute(...e){const t=this.getActionTargetObject(e),s=h.getDuration(this,250),i=o.getDelay(this,0),n=l.getEase(this,"Expo"),{x:r,y:a}=t;let c=r,d=a;switch(this.from){case"LEFT":c=-t.displayWidth;break;case"RIGHT":c=this.scene.scale.width+t.displayWidth;break;case"TOP":d=-t.displayHeight;break;case"BOTTOM":d=this.scene.scale.height+t.displayHeight}t.setPosition(c,d),this.scene.add.tween({targets:t,x:r,y:a,duration:s,delay:i,ease:n,onComplete:()=>{this.executeChildren()}})}}class u extends n{constructor(e){super(e),t(this,"_executing",!1)}execute(e){if(this._executing)return;this._executing=!0;const t=h.getDuration(this,80),s=this.getActionTargetObject(e),{scaleX:i,scaleY:n}=s;this.scene.add.tween({targets:s,scaleX:.8*i,scaleY:.8*n,duration:t,yoyo:!0,onComplete:()=>{this._executing=!1,this.executeChildren(e)}})}}class p extends s.Scene{constructor(){super("Level")}editorCreate(){const e=this.add.image(640,257,"FufuSuperDino"),t=new c(e);new u(t);const s=new r(e),i=new d(s),n=this.add.text(640,458,"",{});n.setOrigin(.5,.5),n.text="Phaser 3 + Phaser Editor v4\nVite + TypeScript",n.setStyle({align:"center",fontFamily:"Arial",fontSize:"3em"});const a=new r(n),o=new d(a);i.from="TOP",o.from="BOTTOM",this.events.emit("scene-awake")}create(){this.editorCreate()}}class g extends n{constructor(e){super(e)}get gameObject(){return super.gameObject}awake(){const e=this.gameObject.width;this.scene.load.on(s.Loader.Events.PROGRESS,(t=>{this.gameObject.width=e*t}))}}class m extends s.Scene{constructor(){super("Preload")}editorCreate(){const e=this.add.image(505.0120544433594,360,"guapen");e.scaleX=.32715486817515643,e.scaleY=.32715486817515643;const t=this.add.rectangle(553.0120849609375,361,256,20);t.setOrigin(0,0),t.isFilled=!0,t.fillColor=14737632,new g(t);const s=this.add.rectangle(553.0120849609375,361,256,20);s.setOrigin(0,0),s.fillColor=14737632,s.isStroked=!0;const i=this.add.text(552.0120849609375,329,"",{});i.text="Loading...",i.setStyle({color:"#e0e0e0",fontFamily:"arial",fontSize:"20px"}),this.events.emit("scene-awake")}preload(){this.editorCreate(),this.load.pack("asset-pack","assets/asset-pack.json")}create(){this.scene.start("Level")}}function y(e){return 16*e}const f=function(e,t){let s=0,i=0;switch(t){case"up":i=-1;break;case"down":i=1;break;case"left":s=-1;break;case"right":s=1}return e.map((e=>({x:e.x+s,y:e.y+i})))};var x=(e=>(e[e.IDLE=0]="IDLE",e[e.WALKING=1]="WALKING",e[e.ATTACKING=2]="ATTACKING",e))(x||{});class b extends s.Physics.Arcade.Sprite{constructor(e,s,i,n,r,a){super(e,y(s),y(i),n),t(this,"currentState",0),t(this,"stateData",{}),t(this,"gridSize"),t(this,"occupiedGrids",[]),t(this,"grid"),this.gridSize=r,this.grid=a,e.add.existing(this),e.physics.add.existing(this),this.setOrigin(.5,.5),this.updateOccupiedGrids(),this.initializeAnimations(),this.setupEventListeners()}initializeAnimations(){this.scene.anims.create({key:"idle",frames:this.scene.anims.generateFrameNumbers("Warrior_Blue",{frames:[0,1]}),frameRate:10,repeat:-1}),this.scene.anims.create({key:"walk",frames:this.scene.anims.generateFrameNumbers("Warrior_Blue",{frames:[1,7,6,7]}),frameRate:10,repeat:-1}),this.scene.anims.create({key:"attack",frames:this.scene.anims.generateFrameNumbers("Warrior_Blue",{frames:[12,13,14,15,16,17]}),frameRate:10,repeat:0})}setupEventListeners(){this.on("animationcomplete",(e=>{this.onAnimationComplete(e)}))}setPlayerState(e,t={}){this.currentState=e,this.stateData=t,this.updateAnimation()}getCurrentState(){return this.currentState}getGridSize(){return this.gridSize}updateAnimation(){switch(this.currentState){case 0:this.play("idle",!0);break;case 1:this.play("walk",!0);break;case 2:this.play("attack",!0)}}updateOccupiedGrids(){const e=[],t=Math.floor(this.x/16),s=Math.floor(this.y/16),i=Math.floor(4),n=Math.floor(4);for(let r=0;r<8;r++)for(let a=0;a<8;a++)e.push({x:t-i+a,y:s-n+r});this.occupiedGrids=e}getOccupiedGrids(){return this.updateOccupiedGrids(),this.occupiedGrids}update(e,t){switch(this.currentState){case 0:break;case 1:const{direction:e}=this.stateData,{x:t,y:s}=this.grid.getNextPosition(this.x,this.y,e);this.setPosition(t,s),this.updateOccupiedGrids(),this.setPlayerState(0);break;case 2:this.setVelocity(0,0)}}onAnimationComplete(e){"attack"===e.key&&this.setPlayerState(0)}moveUp(){this.setPlayerState(1,{direction:"up"})}moveDown(){this.setPlayerState(1,{direction:"down"})}moveLeft(){this.setPlayerState(1,{direction:"left"}),this.setFlipX(!0)}moveRight(){this.setPlayerState(1,{direction:"right"}),this.setFlipX(!1)}stopMoving(){this.setPlayerState(0)}attack(){this.setPlayerState(2)}}class v{constructor(e,s=16){t(this,"scene"),t(this,"cellSize"),t(this,"graphics"),t(this,"visible"),this.scene=e,this.cellSize=s,this.graphics=e.add.graphics(),this.visible=!0,this.draw(),this.scene.cameras.main.on("cameramove",this.updateGrid,this)}draw(){this.graphics.clear();const e=this.scene.physics.world.bounds;this.graphics.lineStyle(1,16777215,.5);const t=e.left,s=e.top,i=e.right,n=e.bottom;for(let r=t;r<=i;r+=this.cellSize)this.graphics.moveTo(r,s),this.graphics.lineTo(r,n);for(let r=s;r<=n;r+=this.cellSize)this.graphics.moveTo(t,r),this.graphics.lineTo(i,r);this.graphics.strokePath()}getNextPosition(e,t,s){let i=Math.floor(e/this.cellSize),n=Math.floor(t/this.cellSize);switch(s){case"up":n-=1;break;case"down":n+=1;break;case"left":i-=1;break;case"right":i+=1}return{x:i,y:n}}toggle(){this.visible=!this.visible,this.graphics.setVisible(this.visible)}show(){this.visible=!0,this.graphics.setVisible(!0)}hide(){this.visible=!1,this.graphics.setVisible(!1)}updateGrid(){this.visible&&this.draw()}destroy(){this.scene.cameras.main.off("cameramove",this.updateGrid,this),this.graphics.destroy()}getCellSize(){return this.cellSize}}class S{constructor(e,s){t(this,"scene"),t(this,"config"),t(this,"element"),t(this,"currentTextIndex"),t(this,"isRevealing"),t(this,"onComplete"),this.scene=e,this.config={...s,style:{fontSize:"24px",backgroundColor:"rgba(31, 28, 22, 0.8)",textColor:"white",padding:"20px",borderRadius:"10px",fontFamily:"Georgia, serif",...s.style||{}},revealSpeed:s.revealSpeed||30},this.element=null,this.currentTextIndex=0,this.isRevealing=!1}create(){var e,t,s,i,n,r;const{width:a,height:c}=this.scene.sys.game.config,o=`\n      background-color: ${null==(e=this.config.style)?void 0:e.backgroundColor}; \n      width: 80%; \n      height: 200px; \n      padding: ${null==(t=this.config.style)?void 0:t.padding}; \n      border-radius: ${null==(s=this.config.style)?void 0:s.borderRadius}; \n      font: ${null==(i=this.config.style)?void 0:i.fontSize} ${null==(n=this.config.style)?void 0:n.fontFamily}; \n      color: ${null==(r=this.config.style)?void 0:r.textColor};\n    `;this.element=this.scene.add.dom(a/2,c-150,"div",o,this.config.texts[this.currentTextIndex]),this.element.setScrollFactor(0),this.element.addListener("click"),this.element.on("click",(()=>this.nextText())),this.scene.input.keyboard&&this.scene.input.keyboard.on("keydown-ENTER",(()=>this.nextText())),this.scene.events.emit("storyBoxTextStart",this.currentTextIndex)}nextText(){this.isRevealing?this.revealFullText():(this.currentTextIndex++,this.currentTextIndex<this.config.texts.length?this.revealText(this.config.texts[this.currentTextIndex]):(this.destroy(),this.config.onComplete&&this.config.onComplete(),this.scene.events.emit("storyBoxComplete")))}revealText(e){if(this.element){this.isRevealing=!0;let t="";const s=setInterval((()=>{var i;t.length<e.length?(t+=e[t.length],null==(i=this.element)||i.setHTML(t)):(clearInterval(s),this.isRevealing=!1,this.scene.events.emit("storyBoxTextComplete",this.currentTextIndex))}),this.config.revealSpeed)}}revealFullText(){this.element&&(this.element.setHTML(this.config.texts[this.currentTextIndex]),this.isRevealing=!1,this.scene.events.emit("storyBoxTextComplete",this.currentTextIndex))}destroy(){this.element&&(this.element.removeListener("click"),this.element.destroy()),this.scene.input.keyboard&&this.scene.input.keyboard.off("keydown-ENTER")}update(){if(this.element){const{width:e,height:t}=this.scene.sys.game.config;this.element.x=e/2,this.element.y=t-150}}}class k{constructor(){t(this,"heldDirections",[]),t(this,"map",{KeyW:"up",KeyS:"down",KeyA:"left",KeyD:"right"})}get direction(){return this.heldDirections[0]}init(){document.addEventListener("keydown",(e=>{const t=this.map[e.code];t&&-1===this.heldDirections.indexOf(t)&&(this.heldDirections.unshift(t),console.log(this.heldDirections))})),document.addEventListener("keyup",(e=>{const t=this.map[e.code],s=this.heldDirections.indexOf(t);s>-1&&(this.heldDirections.splice(s,1),console.log(this.heldDirections))}))}}class w{constructor(e,s,i){t(this,"scene"),t(this,"collisionLayer"),t(this,"gridSize"),this.scene=e,this.collisionLayer=s,this.gridSize=i.getCellSize()}isPositionFree(e){return!e.some((e=>{const t=e.x*this.gridSize,s=e.y*this.gridSize,i=this.collisionLayer.getTileAtWorldXY(t,s);return i&&i.properties.collides}))}}class O extends s.Scene{constructor(){super("MainGameScene"),t(this,"tile_Layer"),t(this,"test_castle"),t(this,"player"),t(this,"cursors"),t(this,"grid"),t(this,"cellSize"),t(this,"storyBox",null),t(this,"directionInput",new k),t(this,"collisionChecker"),t(this,"debugGraphics"),this.grid=null,this.cellSize=16}preload(){this.load.pack("preload-asset-pack","assets/preload-asset-pack.json")}editorCreate(){const e=this.add.tilemap("test_castle");e.addTilesetImage("ShadowtideKeepEntranceMap_test_1","ShadowtideKeepEntranceMap_test_1"),this.add.image(1920,1080,"ShadowtideKeepEntranceMap_test_1");const t=this.add.text(3453,1984,"",{});t.text="SHADOWTIDE\nISLAND",t.setStyle({align:"right",color:"#ceba96ff",fontSize:"54px",fontStyle:"bold",stroke:"#000000ff",strokeThickness:5,"shadow.offsetX":13,"shadow.offsetY":8,"shadow.blur":5,"shadow.fill":!0});const s=e.createLayer("Tile Layer 1",["ShadowtideKeepEntranceMap_test_1"],0,0);this.tile_Layer=s,this.test_castle=e,this.events.emit("scene-awake")}create(){var e;this.editorCreate(),this.debugGraphics=this.add.graphics({lineStyle:{width:1,color:16711680,alpha:.8},fillStyle:{color:16711680,alpha:.3}}),this.physics.world.setBounds(0,0,3840,2160),this.grid=new v(this,this.cellSize),this.player=new b(this,5,5,"Warrior_Blue",128,this.grid),this.directionInput.init(),this.test_castle.setCollisionByProperty({collides:!0}),this.cameras.main.setBounds(0,0,3840,2160),this.cameras.main.startFollow(this.player),null==(e=this.input.keyboard)||e.on("keydown-G",(()=>{var e;null==(e=this.grid)||e.toggle()})),this.input.on("pointerdown",(()=>this.player.attack()));const t={texts:["Welcome to Shadowtide Island!","Your adventure begins here...","Explore the mysteries that await you."],style:{fontSize:"40px",backgroundColor:"rgba(0, 0, 0, 0.8)",textColor:"yellow",padding:"30px",borderRadius:"15px",fontFamily:"Georgia, serif"},revealSpeed:50,onComplete:()=>{console.log("Story completed!")}};this.storyBox=new S(this,t),this.storyBox.create(),this.collisionChecker=new w(this,this.tile_Layer,this.grid),this.player.updateOccupiedGrids(),this.visualizeOccupiedGrids(this.player.getOccupiedGrids(),65280),console.log("Occupied Grids:",this.player.getOccupiedGrids())}update(e,t){var s;null==(s=this.storyBox)||s.update();const i=this.directionInput.direction;if(i&&this.player.getCurrentState()===x.IDLE){switch(i){case"up":this.player.moveUp();break;case"down":this.player.moveDown();break;case"left":this.player.moveLeft();break;case"right":this.player.moveRight()}const e=this.player.getOccupiedGrids();if(this.grid){const t=f(e,i),s=this.collisionChecker.isPositionFree(t);if(console.log("Can Move:",s),this.debugGraphics.clear(),this.visualizeOccupiedGrids(this.player.getOccupiedGrids(),65280),this.visualizeOccupiedGrids(t,16711680),s){const e=this.calculateCenterPosition(t),s=e.x,i=e.y;this.player.setPosition(s,i),this.player.updateOccupiedGrids(),this.player.setPlayerState(x.IDLE)}else console.log("Movement blocked."),this.player.stopMoving()}}}calculateCenterPosition(e){if(0===e.length)return console.error("Grids array is empty."),{x:0,y:0};const t=e[0],s=t.x*this.cellSize,i=t.y*this.cellSize,n=s+this.player.width*this.player.scaleX/2,r=i+this.player.height*this.player.scaleY/2;return console.log(`Grid Center World Coords: (${n}, ${r})`),{x:n,y:r}}visualizeOccupiedGrids(e,t){this.debugGraphics.fillStyle(t,.3),e.forEach((e=>{this.debugGraphics.fillRect(e.x*this.cellSize,e.y*this.cellSize,this.cellSize,this.cellSize)}))}shutdown(){var e;null==(e=this.storyBox)||e.destroy(),this.storyBox=null}}class C extends s.Scene{constructor(){super("Boot")}preload(){this.load.pack("pack","assets/preload-asset-pack.json")}create(){this.scene.start("MainGameScene")}}window.addEventListener("load",(function(){new s.Game({width:1920,height:1080,backgroundColor:"#2f2f2f",parent:"game-container",scale:{mode:s.Scale.ScaleModes.FIT,autoCenter:s.Scale.Center.CENTER_BOTH},scene:[C,m,p,O],dom:{createContainer:!0},physics:{default:"arcade",arcade:{gravity:{x:0,y:0}}}}).scene.start("Boot")}));
